<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Prototype 1v1</title>
<style>
body { margin:0; overflow:hidden; background:black; }
#menu {
  position:absolute; inset:0;
  background:#111; color:white;
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
}
button { padding:15px 30px; font-size:18px; cursor:pointer; }
#hud { position:fixed; top:10px; left:10px; color:white; display:none; }
#result {
  position:fixed; inset:0;
  display:none; justify-content:center; align-items:center;
  background:rgba(0,0,0,0.8);
  color:white; font-size:50px;
}
</style>
</head>
<body>

<!-- MENU -->
<div id="menu">
  <input id="pseudo" placeholder="Pseudo">
  <select id="weapon">
    <option value="pistol">Pistolet</option>
    <option value="smg">Mitraillette</option>
    <option value="shotgun">Pompe</option>
    <option value="sniper">Sniper</option>
  </select>
  <button onclick="start()">JOUER</button>
</div>

<div id="hud">❤ Vie : <span id="life">3</span></div>
<div id="result"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>

<script>
let scene, camera, renderer;
let player, enemy;
let bullets = [];
let life = 3, enemyLife = 3;
let canShoot = true;
let weaponType = "pistol";

function start(){
  weaponType = document.getElementById("weapon").value;
  document.getElementById("menu").style.display="none";
  document.getElementById("hud").style.display="block";
  init();
  animate();
}

function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(Math.random()*0xffffff);

  camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
  camera.position.z = 5;

  renderer = new THREE.WebGLRenderer();
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  const light = new THREE.DirectionalLight(0xffffff,1);
  light.position.set(5,10,5);
  scene.add(light);

  // sol
  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(30,30),
    new THREE.MeshStandardMaterial({color:0x333333})
  );
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);

  // joueur
  player = new THREE.Mesh(
    new THREE.CapsuleGeometry(0.3,1),
    new THREE.MeshStandardMaterial({color:0x00ffcc})
  );
  player.position.y=1;
  scene.add(player);

  // ennemi
  enemy = player.clone();
  enemy.material = enemy.material.clone();
  enemy.material.color.set(0xff3333);
  enemy.position.x=4;
  scene.add(enemy);
}

document.addEventListener("keydown", e=>{
  if(e.key==="z") player.position.z -= 0.2;
  if(e.key==="s") player.position.z += 0.2;
  if(e.key==="q") player.position.x -= 0.2;
  if(e.key==="d") player.position.x += 0.2;
});

document.addEventListener("click", ()=>{
  if(!canShoot) return;
  shoot(player, enemy);
});

function shoot(from, target){
  canShoot=false;
  setTimeout(()=>canShoot=true, weaponType==="smg"?150:weaponType==="sniper"?1000:400);

  const bullet = new THREE.Mesh(
    new THREE.SphereGeometry(0.05),
    new THREE.MeshBasicMaterial({color:0xffff00})
  );
  bullet.position.copy(from.position);
  bullet.userData.dir = new THREE.Vector3().subVectors(target.position, from.position).normalize();
  bullet.userData.target = target;
  bullets.push(bullet);
  scene.add(bullet);
}

function animate(){
  requestAnimationFrame(animate);

  bullets.forEach((b,i)=>{
    b.position.add(b.userData.dir.clone().multiplyScalar(0.4));
    if(b.position.distanceTo(b.userData.target.position)<0.5){
      scene.remove(b);
      bullets.splice(i,1);
      hit(b.userData.target);
    }
  });

  // IA ennemi
  enemy.position.x += Math.sin(Date.now()*0.002)*0.02;
  if(Math.random()<0.01) shoot(enemy, player);

  camera.lookAt(player.position);
  renderer.render(scene,camera);
}

function hit(target){
  if(target===player){
    life--; document.getElementById("life").innerText=life;
    if(life<=0) end("DÉFAITE");
  } else {
    enemyLife--;
    if(enemyLife<=0) end("VICTOIRE");
  }
}

function end(txt){
  document.getElementById("result").style.display="flex";
  document.getElementById("result").innerText=txt;
}
</script>
</body>
</html>


